<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>アハ体験</title>

<style>
body {
    margin: 0;
    background: #000;
    color: #fff;
    font-family: sans-serif;
    cursor: default;
}

#message {
    position: fixed;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    font-size: 1.5rem;
    white-space: pre-line;
}

#startButton {
    margin-top: 20px;
    padding: 12px 24px;
    font-size: 1rem;
    font-weight: bold;
    cursor: default;
}

#imageContainer {
    display: none;
    position: fixed;
    inset: 0;
    margin: auto;
    max-width: 800px;
    max-height: 618px;
}

#imageContainer img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%; height: 100%;
    object-fit: cover;
    transition: opacity 10s ease-in-out;
}

#clickLayer {
    position: fixed;
    inset: 0;
    pointer-events: none;
}

#scareImage {
    position: fixed;
    inset: 0;
    width: 100vw;
    height: 100vh;
    object-fit: cover;
    display: none;
}
</style>
</head>

<body>

<div id="message">
これはアハ体験ミニゲームです。  
画像の変化に気づいたら  
その場所をクリックしてください。
<button id="startButton">開始</button>
</div>

<div id="imageContainer">
    <img id="img1" src="satoru.jpg" style="opacity:1;">
    <img id="img2" src="satoru2.jpg" style="opacity:0;">
  </div>  
<div id="clickLayer"></div>

<img id="scareImage" src="killer.png">
<audio id="scream" src="sound.mp3" preload="auto"></audio>

<script>
const message = document.getElementById("message");
const startButton = document.getElementById("startButton");
document.getElementById("imageContainer").style.display = "none";
const clickLayer = document.getElementById("clickLayer");
const scareImage = document.getElementById("scareImage");
const scream = document.getElementById("scream");

let clickEnabled = false;

startButton.addEventListener("click", () => {
    message.style.display = "none";

    const container = document.getElementById("imageContainer");
    container.style.display = "block";

    clickLayer.style.pointerEvents = "auto";

    setTimeout(() => {
        document.getElementById("img1").style.opacity = "0";
        document.getElementById("img2").style.opacity = "1";
    }, 2000);

    setTimeout(() => { clickEnabled = true; }, 1000);
});

clickLayer.addEventListener("click", () => {
    if (!clickEnabled) {
        const img1 = document.getElementById("img1");
        img1.style.filter = "brightness(1.05)";
        setTimeout(() => {
            img1.style.filter = "";
        }, 80);
        return;
    }

    triggerJumpScare();
});

function triggerJumpScare() {
    const el = document.documentElement;
    if (el.requestFullscreen) {
        el.requestFullscreen().catch(() => {});
    }

    document.getElementById("imageContainer").style.display = "none";

    scareImage.style.display = "block";

    scream.loop = true;
    scream.volume = 1;
    scream.play().catch(() => {});

    let inv = false;
    setInterval(() => {
        inv = !inv;
        scareImage.style.filter = inv ? "invert(1)" : "invert(0)";
    }, 50);
}

</script>
</body>
</html>
